{% extends 'base.html.twig' %}

{% block title %}{{ page_title }} - RSYWX Library{% endblock %}

{% block body %}
<div class="container">
    {% if error %}
        <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle"></i> {{ error }}
        </div>
    {% endif %}

    <div class="row mb-4">
        <div class="col-12">
            <h1><i class="{{ page_icon }}"></i> {{ page_title }}</h1>
            <p class="lead">{{ page_description }}</p>
        </div>
    </div>

    {% if books is not empty %}
        <!-- Books Count -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted">{{ books|length }} book{{ books|length != 1 ? 's' : '' }} found</span>
                    <div class="btn-group btn-group-sm" role="group">
                        <input type="radio" class="btn-check" name="view-mode" id="grid-view" autocomplete="off" checked>
                        <label class="btn btn-outline-secondary" for="grid-view">
                            <i class="bi bi-grid-3x3-gap"></i> Grid
                        </label>
                        <input type="radio" class="btn-check" name="view-mode" id="list-view" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="list-view">
                            <i class="bi bi-list"></i> List
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grid View -->
        <div id="grid-container" class="row">
            {% for book in books %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 book-card">
                    <div class="row g-0 h-100">
                        <div class="col-4">
                            {% if book.hasCover %}
                                <img src="/covers/{{ book.bookid }}.webp" alt="{{ book.title }}" 
                                     class="img-fluid rounded-start h-100" style="object-fit: cover;">
                            {% else %}
                                <div class="bg-secondary rounded-start h-100 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-book text-white display-6"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-8">
                            <div class="card-body d-flex flex-column h-100">
                                <h6 class="card-title">
                                    <a href="{{ path('book_details', {bookId: book.bookid}) }}" 
                                       class="text-decoration-none stretched-link">
                                        {{ book.title|length > 50 ? book.title|slice(0, 50) ~ '...' : book.title }}
                                    </a>
                                </h6>
                                <p class="card-text text-muted small mb-2">
                                    {{ book.author|length > 30 ? book.author|slice(0, 30) ~ '...' : book.author }}
                                </p>
                                <div class="mt-auto">
                                    <small class="text-muted d-block">{{ book.formattedPrice }}</small>
                                    <small class="text-muted">{{ book.formattedPurchaseDate }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- List View -->
        <div id="list-container" class="d-none">
            <div class="card">
                <div class="list-group list-group-flush">
                    {% for book in books %}
                    <div class="list-group-item list-group-item-action">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                {% if book.hasCover %}
                                    <img src="/covers/{{ book.bookid }}.webp" alt="{{ book.title }}" 
                                         class="rounded" style="width: 60px; height: 80px; object-fit: cover;">
                                {% else %}
                                    <div class="bg-secondary rounded d-flex align-items-center justify-content-center" 
                                         style="width: 60px; height: 80px;">
                                        <i class="bi bi-book text-white"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">
                                        <a href="{{ path('book_details', {bookId: book.bookid}) }}" 
                                           class="text-decoration-none">
                                            {{ book.title }}
                                        </a>
                                    </h6>
                                    <small class="text-muted">{{ book.formattedPrice }}</small>
                                </div>
                                <p class="mb-1 text-muted">{{ book.author }}</p>
                                <small class="text-muted">Purchased: {{ book.formattedPurchaseDate }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% else %}
        <div class="row">
            <div class="col-12">
                <div class="alert alert-info text-center" role="alert">
                    <i class="bi bi-info-circle display-4 mb-3"></i>
                    <h4>No Books Found</h4>
                    <p class="mb-3">{{ empty_message|default('No books match the current criteria.') }}</p>
                    <div class="btn-group" role="group">
                        <a href="{{ path('books_dashboard') }}" class="btn btn-primary">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                        <a href="{{ path('books_search') }}" class="btn btn-outline-primary">
                            <i class="bi bi-search"></i> Search Books
                        </a>
                        <a href="{{ path('books_random') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-shuffle"></i> Random Books
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Navigation -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center">
                    <h6 class="card-title">Explore More</h6>
                    <div class="btn-group" role="group">
                        <a href="{{ path('books_dashboard') }}" class="btn btn-outline-primary">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                        <a href="{{ path('books_search') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-search"></i> Search
                        </a>
                        <a href="{{ path('books_latest') }}" class="btn btn-outline-success">
                            <i class="bi bi-clock"></i> Latest
                        </a>
                        <a href="{{ path('books_random') }}" class="btn btn-outline-warning">
                            <i class="bi bi-shuffle"></i> Random
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// View mode toggle
document.addEventListener('DOMContentLoaded', function() {
    const gridView = document.getElementById('grid-view');
    const listView = document.getElementById('list-view');
    const gridContainer = document.getElementById('grid-container');
    const listContainer = document.getElementById('list-container');

    gridView.addEventListener('change', function() {
        if (this.checked) {
            gridContainer.classList.remove('d-none');
            listContainer.classList.add('d-none');
        }
    });

    listView.addEventListener('change', function() {
        if (this.checked) {
            gridContainer.classList.add('d-none');
            listContainer.classList.remove('d-none');
        }
    });
});
</script>
{% endblock %}